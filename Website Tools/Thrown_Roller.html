  <!DOCTYPE html>
  <html lang="en">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thrown Combat Simulation</title>
<link href="style.css" rel="stylesheet" type="text/css" media="all">
  </head>
  <body>
  <p><a href="index.html"><img src="flame_dimetap.gif"></a></p>
      <ul>
    <li><a href="index.html">Home</a></li>
    <li><a href="Rules_JASCI.html">JASCI TRPG Rules</a></li>
    <li><a href="JASCI_Melee_Roller.html">JASCI Melee Roller</a></li>
    <li><a href="JASCI_Ranged_Roller.html">JASCI Ranged Roller</a></li>
    <li><a href="JASCI_Thrown_Roller.html">JASCI Thrown Roller</a></li>
    <li><a href="JASCI_XP_Calculator.html">JASCI XP Calculator</a></li>
    <li><a href="monsters_and_men.html">Monsters and Men</a></li>
  </ul>
  <img src="under_construction.gif">
  <img src="rockthrow2.gif">
<h1>JASCI Thrown Weapons Combat Simulation</h1>
<form id="thrownCombatForm">
  <h2>Thrown</h2>
  <h3>Attacker</h3>
  <button type="button" onclick="loadCharacter('attacker')">Load Character/Creature File</button><br> <!-- Button to load attacker's data -->
  <label for="attackerName">Attacker Name:</label>
  <input type="text" id="attackerName" placeholder="Enter attacker's name"><br>
  
  <label for="thrownType">Thrown Type:</label>
  <select id="thrownType" name="thrownType">
    <option value="Projectile">Projectile</option>
    <option value="Grenade">Grenade</option>
  </select><br>

  <div id="projectileFields">
      <label for="strength" style="background-color: green;">Strength:</label>
      <input type="number" id="strength" name="strength" placeholder="Enter strength value"><br>
  </div>

  <div id="grenadeFields">
      <label for="explosiveSkill" style="background-color: magenta;">Explosive Skill:</label>
      <input type="number" id="explosiveSkill" name="explosiveSkill" placeholder="Enter explosive skill"><br>
  </div>

  <label for="thrownWeaponDamageDice">Thrown Weapon Damage Dice:</label>
  <input type="text" id="thrownWeaponDamageDice" name="thrownWeaponDamageDice" placeholder="e.g., 1d4"><br>

  <label for="thrownWeaponDamageModifier">Thrown Weapon Damage Modifier:</label>
  <input type="number" id="thrownWeaponDamageModifier" name="thrownWeaponDamageModifier" placeholder="Enter damage modifier"><br>

  <label for="targetedBodyPart">Targeted Body part:</label>
  <select id="targetedBodyPart" name="targetedBodyPart">
    <option value="Head">Head: -4</option>
    <option value="Torso">Torso: 0</option>
    <option value="Left Arm">Left Arm: -1</option>
    <option value="Left Hand">Left Hand: -2</option>
    <option value="Right Arm">Right Arm: -1</option>
    <option value="Right Hand">Right Hand: -2</option>
    <option value="Left Leg">Left Leg: -1</option>
    <option value="Left Foot">Left Foot: -2</option>
    <option value="Right Leg">Right Leg: -1</option>
    <option value="Right Foot">Right Foot: -2</option>
  </select><br>

  <label for="range">Range:</label>
  <select id="range" name="range">
    <option value="Close">Close</option>
    <option value="Medium">Medium</option>
    <option value="Long">Long</option>
  </select><br>

  <h3>Defender</h3>
  <button type="button" onclick="loadCharacter('defender')">Load Character/Creature File</button><br> <!-- Button to load defender's data -->
  <label for="defenderName">Defender Name:</label>
  <input type="text" id="defenderName" placeholder="Enter defender's name"><br>
  
  <label for="actionType">Defensive Action:</label>
  <select id="actionType">
      <option value="Blocking">Blocking</option>
      <option value="Dodging">Dodging</option>
  </select><br>

  <div id="blockingFields">
      <label for="meleeWeaponSkill" style="background-color: green;">Melee Weapon Skill:</label>
      <input type="number" id="meleeWeaponSkill" name="meleeWeaponSkill" placeholder="Enter melee weapon skill"><br>

    <label for="isDualWielding">Is Dual Wielding?</label>
    <input type="checkbox" id="isDualWielding" name="isDualWielding">
  </div>

  <div id="dodgingFields" style="display:none;">
      <label for="dexterity" style="background-color: orange;">Dexterity:</label>
      <input type="number" id="dexterity" name="dexterity" placeholder="Enter dexterity value"><br>

      <label for="defenderUnarmedSkill" style="background-color: green;">Defender Unarmed Skill:</label>
      <input type="number" id="defenderUnarmedSkill" name="defenderUnarmedSkill" placeholder="Enter defender unarmed skill"><br>
  </div>

  <label for="bodyPartArmor">Body Part Armor:</label>
  <input type="number" id="bodyPartArmor" name="bodyPartArmor" placeholder="Enter targeted armor rating"><br>

  <label for="degreeOfCover">Degree of Cover:</label>
  <select id="degreeOfCover" name="degreeOfCover">
    <option value="None">None</option>
    <option value="One-quarter">One-quarter</option>
    <option value="One-half">One-half</option>
    <option value="Three-quarters">Three-quarters</option>
    <option value="Nine-tenths">Nine-tenths</option>
    <option value="Total">Total</option>
  </select><br>

  <label for="isDefenderMoving">Is the defender moving?</label>
  <input type="checkbox" id="isDefenderMoving" name="isDefenderMoving"><br>

  <button type="button" onclick="resolveThrownCombat()">Resolve Combat</button>

  <textarea id="thrownConsoleOutput" rows="10" cols="50"></textarea>
</form>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
    const thrownTypeSelect = document.getElementById('thrownType');
    const projectileFields = document.getElementById('projectileFields');
    const grenadeFields = document.getElementById('grenadeFields');
    const actionTypeSelect = document.getElementById('actionType');
    const blockingFields = document.getElementById('blockingFields');
    const dodgingFields = document.getElementById('dodgingFields');

    // Function to toggle visibility of fields based on the selected type
    function toggleFields() {
        // Toggle projectile and grenade fields
        const selectedThrownType = thrownTypeSelect.value;
        if (selectedThrownType === 'Projectile') {
            projectileFields.style.display = 'block';
            grenadeFields.style.display = 'none';
        } else if (selectedThrownType === 'Grenade') {
            projectileFields.style.display = 'none';
            grenadeFields.style.display = 'block';
        } else {
            projectileFields.style.display = 'none';
            grenadeFields.style.display = 'none';
        }

        // Toggle blocking and dodging fields
        const selectedAction = actionTypeSelect.value;
        if (selectedAction === 'Blocking') {
            blockingFields.style.display = 'block';
            dodgingFields.style.display = 'none';
        } else if (selectedAction === 'Dodging') {
            blockingFields.style.display = 'none';
            dodgingFields.style.display = 'block';
        } else {
            blockingFields.style.display = 'none';
            dodgingFields.style.display = 'none';
        }
    }

    // Initial toggle on page load for both sets of fields
    toggleFields();

    // Setup event listeners for changes in either selection
    thrownTypeSelect.addEventListener('change', toggleFields);
    actionTypeSelect.addEventListener('change', toggleFields);
    });

    function resolveThrownCombat() {
        // Retrieve values from the form
        const attackerName = document.getElementById('attackerName').value || 'Attacker';
        const defenderName = document.getElementById('defenderName').value || 'Defender';
        const thrownType = document.getElementById('thrownType').value;
        const strength = parseInt(document.getElementById('strength').value || '0');
        const explosiveSkill = parseInt(document.getElementById('explosiveSkill').value || '0');
        const damageDice = document.getElementById('thrownWeaponDamageDice').value;
        const damageModifier = parseInt(document.getElementById('thrownWeaponDamageModifier').value || '0');
        const targetedBodyPart = document.getElementById('targetedBodyPart').value;
        const range = document.getElementById('range').value;
        const bodyPartArmor = parseInt(document.getElementById('bodyPartArmor').value || '0');
        const degreeOfCover = document.getElementById('degreeOfCover').value;
        const isDefenderMoving = document.getElementById('isDefenderMoving').checked;

        const actionType = document.getElementById('actionType') ? document.getElementById('actionType').value : 'none';
        const dexterity = parseInt(document.getElementById('dexterity').value || '0');
        const unarmedSkill = parseInt(document.getElementById('defenderUnarmedSkill').value || '0');
        const meleeWeaponSkill = parseInt(document.getElementById('meleeWeaponSkill').value || '0');
        const isDualWielding = document.getElementById('isDualWielding').checked;

        const isDodging = actionType === 'Dodging';
        const isBlocking = actionType === 'Blocking';
      
        const coverValues = {
            "None": 0, "One-quarter": 2, "One-half": 4,
            "Three-quarters": 6, "Nine-tenths": 8, "Total": 10
        };
        const coverEffect = coverValues[degreeOfCover];

        let defenseRoll = rollDice('1d20');
        let defenseModifiers = bodyPartArmor + coverEffect + (isDefenderMoving ? 2 : 0);
        if (isDodging) {
            defenseModifiers += dexterity + unarmedSkill;
        }
        if (isBlocking) {
            defenseModifiers += meleeWeaponSkill + (isDualWielding ? 2 : 0);
        }

        let attackRoll = rollDice('1d20');
        let attackModifiers = (thrownType === 'Projectile') ? strength : explosiveSkill;
        attackModifiers += rangeModifier(range);

        appendToConsoleLog(`${attackerName} roll: ${attackRoll + attackModifiers} (1d20+${attackModifiers})`);
        appendToConsoleLog(`${defenderName} roll: ${defenseRoll + defenseModifiers} (1d20+${defenseModifiers})`);

        attackRoll += attackModifiers;
        defenseRoll += defenseModifiers;
        const attackOutcome = attackRoll > defenseRoll ? 'Hit' : 'Miss';
        appendToConsoleLog(attackOutcome);

        if (attackOutcome === 'Hit') {
            const rawDamage = rollDice(damageDice);
            const effectiveDamage = Math.max(0, rawDamage + damageModifier - bodyPartArmor);
            if (thrownType === 'Grenade') {
                appendToConsoleLog(`Damage: ${effectiveDamage} (${damageDice}${damageModifier >= 0 ? '+' : ''}${damageModifier})`);
              distributeGrenadeDamage(effectiveDamage, targetedBodyPart);
            } else {
                appendToConsoleLog(`Damage: ${effectiveDamage} (${damageDice}${damageModifier >= 0 ? '+' : ''}${damageModifier})`);
                appendToConsoleLog(`Damage applied to ${targetedBodyPart}`);
            }
        }
    }

    function distributeGrenadeDamage(damage, target) {
        const bodyParts = {
            'Head': ['Head', 'Torso'],
            'Torso': ['Torso', 'Left arm', 'Right arm', 'Left leg', 'Right leg'],
            'Left Arm': ['Left arm', 'Left hand', 'Torso'],
            'Left Hand': ['Left hand', 'Left arm'],
            'Right Arm': ['Right arm', 'Right hand', 'Torso'],
            'Right Hand': ['Right hand', 'Right arm'],
            'Left Leg': ['Left leg', 'Left foot', 'Torso'],
            'Left Foot': ['Left foot', 'Left leg'],
            'Right Leg': ['Right leg', 'Right foot', 'Torso'],
            'Right Foot': ['Right foot', 'Right leg']
        };

        let affectedParts = bodyParts[target];
        let partDamage = Math.floor(damage / affectedParts.length);

        affectedParts.forEach(part => {
            appendToConsoleLog(`Damage: ${partDamage} applied to ${part}`);
        });

        let remainder = damage % affectedParts.length;
        if (remainder > 0) {
            appendToConsoleLog(`Additional Damage: ${remainder} applied to ${target}`);
        }
    }



  function rollDice(dice) {
    const parts = dice.split('d');
    const count = parseInt(parts[0]);
    const sides = parseInt(parts[1]);
    let total = 0;
    for (let i = 0; i < count; i++) {
      total += Math.floor(Math.random() * sides) + 1;
    }
    return total;
  }

  function rangeModifier(range) {
    switch (range) {
      case 'Close': return 2;
      case 'Medium': return 0;
      case 'Long': return -2;
      default: return 0;
    }
  }

  function appendToConsoleLog(log) {
    const consoleOutput = document.getElementById('thrownConsoleOutput'); // Ensure the correct ID is referenced
    consoleOutput.value += log + '\n';
  }

    // Function to load character data from a JSON file
    function loadCharacter(role) {
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.accept = 'application/json';
        fileInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
                const data = JSON.parse(event.target.result);
                if (role === 'attacker') {
                    fillAttackerFields(data);
                } else if (role === 'defender') {
                    fillDefenderFields(data);
                }
            };
            reader.readAsText(file);
        });
        fileInput.click();
    }

    // Function to fill attacker's fields with data from the loaded character
    function fillAttackerFields(data) {
        document.getElementById('attackerName').value = data.name;
        // Fill other attacker fields
        if (data.stats) {
            document.getElementById('strength').value = parseInt(data.stats.Strength) || 0;
            document.getElementById('explosiveSkill').value = parseInt(data.stats.Explosives_Skill) || 0;
            // Add other stats as needed
        }
    }

    // Function to fill defender's fields with data from the loaded character
    function fillDefenderFields(data) {
        document.getElementById('defenderName').value = data.name;
        // Fill other defender fields
        if (data.stats) {
            document.getElementById('defenderUnarmedSkill').value = parseInt(data.stats.Unarmed_Skill) || 0;
            document.getElementById('meleeWeaponSkill').value = parseInt(data.stats.Melee_Weapons) || 0;
            document.getElementById('dexterity').value = parseInt(data.stats.Dexterity) || 0;
            // Add other stats as needed
        }
    }
  </script>

</body>
</html>
